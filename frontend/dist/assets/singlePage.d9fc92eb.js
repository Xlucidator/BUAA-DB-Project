import{d as Z,b as f,K as ee,A as v,L as K,V as M,x as te,e as x,i as s,g as t,w as l,c as T,z as B,f as m,j as E,F as N,h as le,M as oe,v as ae,N as ne,O as se,P as de,a as i,o as _,k as h,y as F,t as U,Q as ie,_ as ue}from"./index.620621f6.js";import{N as o}from"./utils.f640e782.js";const re={class:"card-header"},ce={class:"text-3xl font-extrabold"},me={class:"deletePassage"},pe={class:"editor"},_e={class:"dialog-footer"},ge={class:"addReply"},fe={class:"confirmReply"},he=Z({__name:"singlePage",props:{modelValue:null,height:{default:"700px"},width:{default:"500px"},placeholder:{default:"\u8BF7\u8F93\u5165\u5185\u5BB9"}},emits:["update:modelValue"],setup(C,{emit:D}){const L=C,p=le();console.log("router",p);let d=[],r=f(0),c=f(!1),u=f({Title:"",Content:"",Poster:""}),y=f(""),P=f([]);const V=f(""),O=()=>{p.go(-1)};ee(v,p.currentRoute.value.params.id).then(e=>{console.log("getSinglePage",e),e.status!==200?"details"in e.data?o(0,e.data.details):o(0,"ops~! other error"):(o(1,"got passage successfully~"),d.splice(0,1,e.data),console.log("passage",d),console.log("itemKey",r),u.value.Title=d[0].Title,u.value.Poster=d[0].Poster,u.value.Content=d[0].Content,y.value=K.exports.xss.process(M.vMdParser.themeConfig.markdownParser.render(d[0].Content)),console.log("itemKey",r),console.log("htmlContent",y),r.value=1-r.value)}).catch(e=>{console.log(e),o(0,e.detail)}),te({get(){return L.modelValue},set(e){D("update:modelValue",e)}});const I=(e,n)=>{console.log(n)},j=()=>{d[0].Title=u.value.Title,d[0].Content=u.value.Content,d[0].Poster=u.value.Poster,ie(v(),p.currentRoute.value.params.id,d[0]).then(e=>{console.log("updatePostContent ",e),e.status!==200?"details"in e.data?o(0,e.data.details):o(0,"ops~! other error"):(o(1,e.data),d.splice(0,1,e.data),c.value=!1,y.value=K.exports.xss.process(M.vMdParser.themeConfig.markdownParser.render(d[0].Content)),r.value=1-r.value)}).catch(e=>{console.log("updatePostContent err ",e),o(0,e.detail)})},z=()=>{oe(v(),p.currentRoute.value.params.id,V.value,ae.state.user.CodeName).then(e=>{console.log("insertReply ",e),e.status!==201?"details"in e.data?o(0,e.data.details):o(0,"ops~! other error"):(o(1,e.data),V.value="",console.log(P),A())}).catch(e=>{console.log("insertReply err ",e),o(0,e.detail)})},A=()=>{ne(v,p.currentRoute.value.params.id).then(e=>{console.log("getReplyFromPassage",e),e.status!==200?"details"in e.data?o(0,e.data.details):o(0,"ops~! other error"):(o(1,"got reply successfully~"),P.value=e.data,r.value=1-r.value)}).catch(e=>{console.log(e),o(0,e.detail)})};A();const G=()=>{se.confirm("this action will permanently delete the post. Continue?","Warning",{confirmButtonText:"OK",cancelButtonText:"Cancel",type:"warning"}).then(()=>{de(v(),p.currentRoute.value.params.id).then(e=>{console.log("deletePassage ",e),e.status!==204?"details"in e.data?o(0,e.data.details):o(0,"ops~! other error"):(o(1,e.data),p.go(-1))}).catch(e=>{console.log("updatePostContent err ",e),o(0,e.detail)})}).catch(()=>{console.log("updatePostContent err ")})};return(e,n)=>{const Q=i("ArrowLeft"),w=i("el-icon"),g=i("el-button"),W=i("EditPen"),$=i("v-md-preview-html"),b=i("el-card"),q=i("Delete"),k=i("el-input"),R=i("el-form-item"),H=i("v-md-editor"),J=i("el-form"),X=i("el-dialog"),S=i("el-timeline-item"),Y=i("el-timeline");return _(),x(N,null,[(_(),x("span",{key:s(r).value})),t(g,{onClick:O,style:{"margin-top":"2%","margin-left":"5%"}},{default:l(()=>[t(w,null,{default:l(()=>[t(Q)]),_:1}),h(" back ")]),_:1}),s(d).length>0?(_(),T(b,{key:0,class:"box-card"},{header:l(()=>[m("div",re,[m("p",ce,F(s(d)[0].Title),1),t(g,{onClick:n[0]||(n[0]=a=>E(c)?c.value=!0:c=!0),class:"button",text:""},{default:l(()=>[t(w,null,{default:l(()=>[t(W)]),_:1}),h(" Edit ")]),_:1})])]),default:l(()=>[t($,{html:s(y),"preview-class":"vuepress-markdown-body"},null,8,["html"])]),_:1})):B("",!0),m("div",me,[t(g,{onClick:G,class:"button",text:""},{default:l(()=>[h(" delete passage "),t(w,null,{default:l(()=>[t(q)]),_:1})]),_:1})]),t(X,{width:"90%",modelValue:s(c),"onUpdate:modelValue":n[5]||(n[5]=a=>E(c)?c.value=a:c=a),title:"EDIT PASSAGE"},{footer:l(()=>[m("span",_e,[t(g,{onClick:n[4]||(n[4]=a=>E(c)?c.value=!1:c=!1)},{default:l(()=>[h("Cancel")]),_:1}),t(g,{type:"primary",onClick:j},{default:l(()=>[h("Confirm")]),_:1})])]),default:l(()=>[t(J,{model:s(u)},{default:l(()=>[t(R,{label:"title","label-width":60},{default:l(()=>[t(k,{modelValue:s(u).Title,"onUpdate:modelValue":n[1]||(n[1]=a=>s(u).Title=a)},null,8,["modelValue"])]),_:1}),t(R,{label:"author","label-width":60},{default:l(()=>[t(k,{modelValue:s(u).Poster,"onUpdate:modelValue":n[2]||(n[2]=a=>s(u).Poster=a),disabled:""},null,8,["modelValue"])]),_:1}),t(R,{label:"content","label-width":60},{default:l(()=>[m("div",pe,[t(H,{placeholder:C.placeholder,"disabled-menus":[],modelValue:s(u).Content,"onUpdate:modelValue":n[3]||(n[3]=a=>s(u).Content=a),height:C.height,width:C.width,onChange:I},null,8,["placeholder","modelValue","height","width"])])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"]),m("div",ge,[t(k,{modelValue:V.value,"onUpdate:modelValue":n[6]||(n[6]=a=>V.value=a),rows:2,type:"textarea",placeholder:"Please input"},null,8,["modelValue"]),m("div",fe,[t(g,{onClick:z,class:"button",type:"primary"},{default:l(()=>[h(" reply ")]),_:1})]),t(Y,null,{default:l(()=>[s(r)===0?(_(!0),x(N,{key:0},U(s(P),a=>(_(),T(S,{center:"",timestamp:a.Replier,placement:"top"},{default:l(()=>[t(b,{shadow:"hover"},{default:l(()=>[m("p",null,F(a.Content),1)]),_:2},1024)]),_:2},1032,["timestamp"]))),256)):B("",!0),s(r)===1?(_(!0),x(N,{key:1},U(s(P),a=>(_(),T(S,{center:"",timestamp:a.Replier,placement:"top"},{default:l(()=>[t(b,{shadow:"hover"},{default:l(()=>[m("p",null,F(a.Content),1)]),_:2},1024)]),_:2},1032,["timestamp"]))),256)):B("",!0)]),_:1})])],64)}}});const ye=ue(he,[["__scopeId","data-v-a4cddd64"]]);export{ye as default};
